<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sd.mommyson.member.dao.MemberDAO">
	<resultMap type="com.sd.mommyson.member.dto.UserDTO" id="userResultMap">
		<id property="memCode" column="MEM_CODE"/>
		<result property="name" column="NAME"/>
		<result property="repCount" column="REP_COUNT"/>
	</resultMap>

	<resultMap type="com.sd.mommyson.member.dto.CeoDTO" id="ceoResultMap">
		<id property="memCode" column="MEM_CODE"/>
		<result property="account" column="ACCOUNT"/>
		<result property="startDate" column="START_DATE"/>
		<result property="no" column="STORE_NO"/>
		<result property="name" column="CEO_NAME"/>
		<result property="img" column="STORE_IMG"/>
		<result property="openingTime" column="OPENING_TIME"/>
		<result property="storeInfo" column="STORE_INFO"/>
	</resultMap>

	<resultMap id="memberResultMap" type="com.sd.mommyson.member.dto.MemberDTO">
		<id property="memCode" column="MEM_CODE"/>
		<result property="email" column="EMAIL"/>
		<result property="memPwd" column="MEM_PWD"/>
		<result property="address" column="ADDRESS"/>
		<result property="postCode" column="POST_CODE"/>
		<result property="dAddress" column="D_ADDRESS"/>
		<result property="phone" column="PHONE"/>
		<result property="memType" column="MEM_TYPE"/>
		<result property="locationCode" column="LOCATION_CODE"/>
		<result property="nickname" column="NICKNAME"/>
		<result property="memId" column="MEM_ID"/>
		<result property="enrollDate" column="ENROLL_DATE"/>
		<result property="isDeleted" column="IS_DELETED"/>
		<collection property="user" resultMap="userResultMap"/>
		<collection property="ceo" resultMap="ceoResultMap"/>
	</resultMap>

	<select id="selectAll" resultType="_int">
		SELECT * FROM TEST
	</select>
	
	<select id="selectEncPassword" resultType="String">
		SELECT 
			   A.MEM_PWD
		  FROM MEMBER_TBL A
		 WHERE A.MEM_ID = #{ memId }
	</select>
	
	<select id="selectMember" resultMap="memberResultMap">
		SELECT 
			   A.MEM_CODE
			 , A.EMAIL
			 , A.ADDRESS
			 , A.POST_CODE
			 , A.D_ADDRESS
			 , A.PHONE
			 , A.MEM_TYPE
			 , A.LOCATION_CODE
			 , A.NICKNAME
			 , A.MEM_ID
			 , A.ENROLL_DATE
			 , B.NAME
			 , B.REP_COUNT
			 , C.MEM_CODE
		     , C.ACCOUNT
			 , C.START_DATE
			 , C.STORE_NO
			 , C.CEO_NAME
			 , C.STORE_IMG
		  FROM MEMBER_TBL A
		  LEFT JOIN USER_TBL B ON (A.MEM_CODE = B.MEM_CODE)
		  LEFT JOIN CEO_TBL C ON (A.MEM_CODE = C.MEM_CODE)
		 WHERE A.IS_DELETED = 'N'
		   AND A.MEM_ID = #{ memId }
	</select>
	
	<select id="selectLocation" resultType="hashmap">
		SELECT 
			   A.LOCATION_CODE
			 , A.LOCATION_NAME
		  FROM LOCATION A
		 WHERE LOCATION_CODE != 'L0'
	</select>
	
	<select id="selectCategoryList" resultType="hashmap">
		SELECT 
			   A.CATEGORY_CODE
			 , A.CATEGORY_NAME
		  FROM CATEGORY_TBL A
	</select>
	
	<!-- 아이디 중복 검사 -->
	<select id="idChk" resultType="int">
		SELECT COUNT(*) 
	      FROM MEMBER_TBL
	     WHERE MEM_ID = #{memId} 
	</select>
</mapper>